"use strict";var e=Object.defineProperty,s=(s,t,r)=>((s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r)(s,"symbol"!=typeof t?t+"":t,r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),r=require("react");class n{constructor(e){s(this,"apiUrl"),s(this,"defaultHeaders"),this.apiUrl=e.replace(/\/$/,""),this.defaultHeaders={"Content-Type":"application/json"}}async testConnection(){try{const e=await fetch(`${this.apiUrl}/health`,{method:"GET",headers:this.defaultHeaders});if(!e.ok)return{success:!1,error:`Health check failed: ${e.status} ${e.statusText}`};const s=await e.json();return{success:"healthy"===s.status||"degraded"===s.status,error:"healthy"!==s.status?s.error:void 0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Connection failed"}}}async sendStreamingMessage(e){const s=await fetch(`${this.apiUrl}/api/chat`,{method:"POST",headers:{...this.defaultHeaders,Accept:"text/event-stream"},body:JSON.stringify({...e,stream:!0})});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return s}async sendMessage(e){const s=await fetch(`${this.apiUrl}/api/chat`,{method:"POST",headers:this.defaultHeaders,body:JSON.stringify({...e,stream:!1})});if(!s.ok){const e=await s.text();throw new Error(`HTTP ${s.status}: ${e}`)}return s.json()}async*processStreamingResponse(e){var s;const t=null==(s=e.body)?void 0:s.getReader(),r=new TextDecoder;if(!t)throw new Error("No response body reader available");try{let e="";for(;;){const{done:s,value:a}=await t.read();if(s)break;e+=r.decode(a,{stream:!0});const o=e.split("\n");e=o.pop()||"";for(const e of o){const s=e.trim();if(s.startsWith("data: ")){const e=s.slice(6);if("[DONE]"===e)return;try{const s=JSON.parse(e);yield s}catch(n){console.warn("Failed to parse SSE data:",e,n)}}}}}finally{t.releaseLock()}}async getAvailableModels(){const e=await fetch(`${this.apiUrl}/api/chat/models`,{method:"GET",headers:this.defaultHeaders});if(!e.ok)throw new Error(`Failed to fetch models: ${e.status}`);return e.json()}async testChat(){try{const e=await fetch(`${this.apiUrl}/api/chat/test`,{method:"GET",headers:this.defaultHeaders});if(!e.ok)return{success:!1,message:`Test failed: ${e.status}`};return{success:!0,message:(await e.json()).message||"Test successful"}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Test failed"}}}async getContentTypes(){try{const e=await fetch(`${this.apiUrl}/api/chat/content-types`,{method:"GET",headers:this.defaultHeaders});if(!e.ok)return[];return(await e.json()).contentTypes||[]}catch(e){return console.warn("Failed to fetch content types:",e),[]}}}const a=(e,s)=>{const[t,a]=r.useState({messages:[],isLoading:!1,isConnected:!1,error:null,conversationId:null}),o=r.useRef(new n(e)),c=r.useRef(null),i=r.useRef(!1);r.useEffect(()=>{(async()=>{if(!i.current)try{i.current=!0;const e=await o.current.testConnection();a(s=>({...s,isConnected:e.success,error:e.success?null:e.error||"Connection failed"}))}catch(e){a(s=>({...s,isConnected:!1,error:e instanceof Error?e.message:"Connection test failed"}))}})()},[]);const l=r.useCallback(async(e,r=!0)=>{c.current&&c.current.abort(),c.current=new AbortController;const n={id:`user-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,content:e,role:"user",timestamp:new Date,metadata:(null==s?void 0:s.userId)?{userId:s.userId}:void 0};a(e=>({...e,messages:[...e.messages,n],isLoading:!0,error:null}));try{const n={message:e,conversationId:t.conversationId||void 0,userId:(null==s?void 0:s.userId)||void 0,stream:r,useContentstack:(null==s?void 0:s.useContentstack)||void 0,contentTypes:(null==s?void 0:s.contentTypes)||void 0,maxContextLength:(null==s?void 0:s.maxContextLength)||void 0};if(r){const e=await o.current.sendStreamingMessage(n);let s={id:`assistant-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,content:"",role:"assistant",timestamp:new Date,metadata:{}};a(e=>({...e,messages:[...e.messages,s],isConnected:!0}));for await(const t of o.current.processStreamingResponse(e))if("content"===t.type&&t.content)s={...s,content:s.content+t.content},a(e=>({...e,messages:[...e.messages.slice(0,-1),s]}));else{if("done"===t.type){t.metadata.fullContent&&(s={...s,content:t.metadata.fullContent,timestamp:new Date(t.metadata.timestamp)},a(e=>({...e,messages:[...e.messages.slice(0,-1),s],conversationId:e.conversationId||`conv-${Date.now()}`})));break}if("error"===t.type)throw new Error(t.error||"Streaming error occurred")}}else{const e=await o.current.sendMessage(n),s={id:e.message.id,content:e.message.content,role:e.message.role,timestamp:new Date(e.message.timestamp),metadata:{contentEnhanced:e.enhancedWithContent}};a(t=>({...t,messages:[...t.messages,s],conversationId:e.conversationId,isConnected:!0}))}}catch(i){console.error("Chat error:",i),a(e=>({...e,error:i instanceof Error?i.message:"An error occurred while sending the message",isConnected:!1}))}finally{a(e=>({...e,isLoading:!1})),c.current=null}},[s,t.conversationId]),d=r.useCallback(()=>{a(e=>({...e,messages:[],conversationId:null,error:null}))},[]),u=r.useCallback(()=>{a(e=>({...e,error:null}))},[]),h=r.useCallback(async()=>{a(e=>({...e,isLoading:!0,error:null}));try{const e=await o.current.testConnection();a(s=>({...s,isConnected:e.success,error:e.success?null:e.error||"Reconnection failed",isLoading:!1}))}catch(e){a(s=>({...s,isConnected:!1,error:e instanceof Error?e.message:"Reconnection failed",isLoading:!1}))}},[]);return r.useEffect(()=>()=>{c.current&&c.current.abort()},[]),{...t,sendMessage:l,clearMessages:d,retry:u,reconnect:h}},o={primaryColor:"#007bff",fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',borderRadius:"8px",backgroundColor:"#ffffff",textColor:"#333333",inputBorderColor:"#e1e5e9",headerColor:"#007bff",userMessageColor:"#007bff",assistantMessageColor:"#f8f9fa"},c=e=>{const s=r.useMemo(()=>({...o,...e}),[e]),t=r.useMemo(()=>({"--techsurf-chat-primary-color":s.primaryColor,"--techsurf-chat-font-family":s.fontFamily,"--techsurf-chat-border-radius":s.borderRadius,"--techsurf-chat-bg-color":s.backgroundColor,"--techsurf-chat-text-color":s.textColor,"--techsurf-chat-input-border-color":s.inputBorderColor,"--techsurf-chat-header-color":s.headerColor,"--techsurf-chat-user-message-color":s.userMessageColor,"--techsurf-chat-assistant-message-color":s.assistantMessageColor}),[s]);return{theme:s,cssVariables:t}},i=({title:e,subtitle:s,onMinimize:r,onClose:n,isConnected:a=!1,isLoading:o=!1,showConnectionStatus:c=!0})=>{const i=o?{text:"Connecting...",className:"techsurf-connecting"}:a?{text:"Online",className:"techsurf-connected"}:{text:"Offline",className:"techsurf-disconnected"};return t.jsx("header",{className:"techsurf-chat-header",children:t.jsxs("div",{className:"techsurf-header-content",children:[t.jsxs("div",{className:"techsurf-header-info",children:[t.jsx("h3",{className:"techsurf-chat-title",children:e}),s&&t.jsx("p",{className:"techsurf-chat-subtitle",children:s}),c&&t.jsxs("div",{className:"techsurf-connection-status",children:[t.jsx("div",{className:`techsurf-status-dot ${i.className}`}),t.jsx("span",{className:"techsurf-status-text",children:i.text})]})]}),t.jsxs("div",{className:"techsurf-header-actions",children:[r&&t.jsx("button",{className:"techsurf-header-button techsurf-minimize-button",onClick:r,"aria-label":"Minimize chat",type:"button",children:t.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}),n&&t.jsx("button",{className:"techsurf-header-button techsurf-close-button",onClick:n,"aria-label":"Close chat",type:"button",children:t.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]})})},l=({message:e,isStreaming:s=!1,showTimestamp:r=!0})=>{var n;const a="user"===e.role;if("system"===e.role)return null;const o=["techsurf-message-bubble",a?"techsurf-user-message":"techsurf-assistant-message",s?"techsurf-streaming":""].filter(Boolean).join(" ");return t.jsxs("div",{className:o,children:[t.jsxs("div",{className:"techsurf-message-content",children:[t.jsxs("div",{className:"techsurf-message-text",children:[e.content,s&&t.jsx("span",{className:"techsurf-cursor",children:"|"})]}),(null==(n=e.metadata)?void 0:n.contentEnhanced)&&t.jsx("div",{className:"techsurf-content-badge",title:"Enhanced with knowledge base",children:"🧠 Enhanced"})]}),r&&t.jsx("div",{className:"techsurf-message-timestamp",children:(c=e.timestamp,c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))})]});var c},d=({message:e="AI is thinking...",className:s=""})=>t.jsxs("div",{className:`techsurf-loading-indicator ${s}`,children:[t.jsxs("div",{className:"techsurf-loading-dots",children:[t.jsx("div",{className:"techsurf-dot"}),t.jsx("div",{className:"techsurf-dot"}),t.jsx("div",{className:"techsurf-dot"})]}),t.jsx("span",{className:"techsurf-loading-message",children:e})]}),u=({messages:e,isLoading:s,error:n,onRetry:a,showTimestamps:o=!0,emptyStateMessage:c="Start a conversation with your AI assistant!"})=>{var i;const u=r.useRef(null),h=r.useRef(null);r.useEffect(()=>{const e=setTimeout(()=>{u.current&&u.current.scrollIntoView({behavior:"smooth",block:"end"})},100);return()=>clearTimeout(e)},[e.length,s]);const m=e.filter(e=>"system"!==e.role);return t.jsxs("div",{className:"techsurf-message-list",ref:h,children:[t.jsxs("div",{className:"techsurf-messages-container",children:[0===m.length&&!s&&!n&&t.jsxs("div",{className:"techsurf-empty-state",children:[t.jsx("div",{className:"techsurf-empty-icon",children:"💬"}),t.jsx("p",{className:"techsurf-empty-message",children:c})]}),m.map((e,r)=>t.jsx(l,{message:e,isStreaming:s&&"assistant"===e.role&&r===m.length-1,showTimestamp:o},e.id)),s&&m.length>0&&"user"===(null==(i=m[m.length-1])?void 0:i.role)&&t.jsx(d,{message:"AI is responding..."}),n&&t.jsxs("div",{className:"techsurf-error-message",children:[t.jsxs("div",{className:"techsurf-error-content",children:[t.jsx("span",{className:"techsurf-error-icon",children:"⚠️"}),t.jsx("span",{className:"techsurf-error-text",children:n})]}),a&&t.jsx("button",{className:"techsurf-retry-button",onClick:a,type:"button",children:"Retry"})]})]}),t.jsx("div",{ref:u})]})},h=({onSendMessage:e,disabled:s=!1,placeholder:n="Type your message...",maxLength:a=2e3,showSendButton:o=!0})=>{const[c,i]=r.useState(""),l=r.useRef(null),d=r.useRef(null);r.useEffect(()=>{(()=>{const e=l.current;if(e){e.style.height="auto";const s=e.scrollHeight,t=120;e.style.height=Math.min(s,t)+"px"}})()},[c]);const u=t=>{t&&t.preventDefault();const r=c.trim();r&&!s&&r.length<=a&&(e(r),i(""),l.current&&(l.current.style.height="auto"))},h=c.trim().length>0&&!s&&c.length<=a;return t.jsxs("form",{className:"techsurf-chat-input-container",onSubmit:u,ref:d,children:[t.jsxs("div",{className:"techsurf-input-wrapper",children:[t.jsx("textarea",{ref:l,className:"techsurf-message-input",value:c,onChange:e=>{const s=e.target.value;s.length<=a&&i(s)},onKeyDown:e=>{var s;"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u()),"Escape"===e.key&&(i(""),null==(s=l.current)||s.blur())},placeholder:s?"Connecting...":n,disabled:s,rows:1,"aria-label":"Type your message"}),t.jsxs("div",{className:"techsurf-input-actions",children:[a>0&&t.jsxs("div",{className:"techsurf-char-counter "+(c.length>.9*a?"techsurf-char-warning":""),children:[c.length,"/",a]}),o&&t.jsx("button",{type:"submit",className:"techsurf-send-button",disabled:!h,"aria-label":"Send message",children:t.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"techsurf-send-icon","aria-hidden":"true",children:[t.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),t.jsx("polygon",{points:"22,2 15,22 11,13 2,9 22,2"})]})})]})]}),t.jsx("div",{className:"techsurf-input-hint",children:"Press Enter to send, Shift+Enter for new line, Esc to clear"})]})},m=({apiUrl:e,agentId:s,theme:n,title:o="AI Assistant",placeholder:l="Type your message...",height:d="500px",width:m="380px",position:f="bottom-right",minimized:g=!1,useContentstack:p=!0,contentTypes:x=[],maxContextLength:y=2e3,onMessage:v,onError:b,onConnect:C,onDisconnect:w})=>{var j;const[N,k]=r.useState(g),[E,S]=r.useState(!g),[T,M]=r.useState(!1),I={agentId:s||void 0,useContentstack:p||void 0,contentTypes:x||void 0,maxContextLength:y||void 0,userId:`user-${Date.now()}`},{messages:$,isLoading:L,isConnected:R,error:H,sendMessage:D,retry:O,reconnect:A}=a(e,I),{cssVariables:B}=c(n);r.useEffect(()=>{if(v&&$.length>0){const e=$[$.length-1];e&&"assistant"===e.role&&v(e)}},[$,v]),r.useEffect(()=>{b&&H&&b(new Error(H))},[H,b]),r.useEffect(()=>{R&&C?C():!R&&T&&w&&w()},[R,C,w,T]);const U=r.useCallback(()=>{k(!N)},[N]),W=r.useCallback(()=>{S(!E),E||k(!1)},[E]),z=r.useCallback(async e=>{M(!0),await D(e,!0)},[D]),F=r.useCallback(()=>{O(),R||A()},[O,A,R]);return r.useEffect(()=>{const e=e=>{if("Escape"===e.key&&E&&!N){const e=document.activeElement,s=document.querySelector(".techsurf-chat-widget");(null==s?void 0:s.contains(e))&&k(!0)}};if(E)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[E,N]),t.jsxs("div",{className:`techsurf-chat-widget-container ${(()=>{switch(f){case"bottom-left":return"techsurf-position-bottom-left";case"center":return"techsurf-position-center";default:return"techsurf-position-bottom-right"}})()}`,style:B,children:[!E&&t.jsxs("button",{className:"techsurf-chat-trigger-button",onClick:W,"aria-label":`Open ${o}`,type:"button",children:[t.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"techsurf-chat-icon","aria-hidden":"true",children:t.jsx("path",{d:"21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})}),!R&&T&&t.jsx("div",{className:"techsurf-notification-badge","aria-label":"Connection issue",children:"!"})]}),E&&t.jsxs("div",{className:"techsurf-chat-widget "+(N?"techsurf-minimized":""),style:{height:N?"auto":d,width:m},role:"dialog","aria-labelledby":"techsurf-chat-title",children:[t.jsx(i,{title:o,subtitle:p?"Enhanced with knowledge base":void 0,onMinimize:U,onClose:W,isConnected:R,isLoading:L&&!T,showConnectionStatus:T}),!N&&t.jsxs(t.Fragment,{children:[t.jsx(u,{messages:$,isLoading:L,error:H,onRetry:F,emptyStateMessage:`Hi! I'm your ${o.toLowerCase()}. ${p?"I have access to our knowledge base to provide accurate information.":"How can I help you today?"}`}),t.jsx(h,{onSendMessage:z,disabled:L||!R&&T,placeholder:!R&&T?"Reconnecting...":l,maxLength:2e3}),"undefined"!=typeof process&&"development"===(null==(j=process.env)?void 0:j.NODE_ENV)&&t.jsx("div",{className:"techsurf-debug-info",children:t.jsxs("small",{children:["Connected: ",R?"✓":"✗"," | Content:"," ",p?"✓":"✗"," | Messages:"," ",$.length]})})]})]})]})};exports.ChatApiService=n,exports.ChatHeader=i,exports.ChatInput=h,exports.ChatWidget=m,exports.LoadingIndicator=d,exports.MessageBubble=l,exports.MessageList=u,exports.TechSurfChatWidget=m,exports.useChat=a,exports.useTheme=c;
//# sourceMappingURL=index.cjs.js.map
